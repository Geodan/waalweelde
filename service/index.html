<!doctype html>
<html lang="nl" ng-app="icm">
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <!-- openlayers -->
  <link rel="stylesheet" type="text/css" href="./libs/openlayers/theme/default/style.css" />
<link rel="stylesheet" href="libs/bootstrap-3.1.1-dist/css/bootstrap.min.css">

    <script type="text/javascript" src="./libs/openlayers/OpenLayers.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>


  <script type="text/javascript" src="libs/proj4js/lib/proj4js-compressed.js"></script> 
<script type="text/javascript" src="libs/styles.js"></script>
<script type="text/javascript" src="libs/popup.js"></script>
<script type="text/javascript" src="libs/layers.js"></script>
<script src="libs/bootstrap-3.1.1-dist//js/bootstrap.min.js"></script>

  <script>
  Proj4js.defs["EPSG:28992"] = "+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs";
  </script>
   <style>
  body, html, .container-fluid , #map, .hoog{

  height: 100%;
  }
  .container-fluid
{
    display:table;
    width: 100%;
    
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}
  .uitleg {
margin-left: 0;
margin-right: 0;
background-color: #fff;
border: solid 1px #ddd;
box-shadow: none;
    position: relative;
padding: 45px 15px 15px;
margin: 0 -15px 15px;
  }
  .uitleg:after {

position: absolute;
top: 15px;
left: 15px;
font-size: 12px;
font-weight: 700;
color: #bbb;
text-transform: uppercase;
letter-spacing: 1px;
}
.classificeren:after {
  content: "2 classificeren";
}
.selecteren:after {
  content: "1 selecteren";
}
  </style>
 <script type="text/javascript">
  var map, select, perceelcontrol, navcontrol, editcontrol, selectcontrol, wmts, ecotopen;
  var geojsonf = new OpenLayers.Format.GeoJSON;
  function init(){
    map =  new OpenLayers.Map( 'map', {
    projection: "EPSG:28992",
    units: "m",
    resolutions: [3440.64, 1720.32, 860.16, 430.08, 215.04, 107.52, 53.76,
        26.88, 13.44, 6.72, 3.36, 1.68, 0.84, 0.42, 0.21],
    maxExtent: [-285401.92,22598.08,595401.9199999999,903401.9199999999],
    controls: [
        new OpenLayers.Control.Zoom()
        
        
        ]
    });


            
    select = new OpenLayers.Layer.Vector( "Editable",{styleMap:noStyleMap} );

    map.addLayers([wmts,ecotopen, select]);
    navcontrol =     new OpenLayers.Control.Navigation();
    perceelcontrol = new OpenLayers.Control.GetFeature({
        protocol: OpenLayers.Protocol.WFS.fromWMSLayer(ecotopen),
        box: false,
        multipleKey: "shiftKey",
        toggleKey: "ctrlKey"
    });
    editcontrol = new OpenLayers.Control.DrawFeature(select,
                            OpenLayers.Handler.Polygon);

    selectcontrol = new OpenLayers.Control.SelectFeature(select);
    perceelcontrol.events.register("featureselected", this, function(e) {
        select.addFeatures([e.feature]);
    });
    perceelcontrol.events.register("featureunselected", this, function(e) {
        select.removeFeatures([e.feature]);
    });
    
    select.onFeatureInsert = function(e){
      if(select.features.length > 0) {
        //we hebben features
        $('#btn-class').prop('disabled',false);
        $('.classificeren').removeClass('text-muted');
        $('#btn-calc').prop('disabled',false);
      }
      else {
         $('#btn-class').prop('disabled','disabled');
        $('.classificeren').addClass('text-muted');
        $('#btn-calc').prop('disabled','disabled');
      }
    };
    selectcontrol.onSelect = function(feature){
        if(feature.popup === null) {
        var text = '';
        if(feature.attributes.eco_code !== undefined) {
          //we hebben een perceel
          var code = feature.attributes.eco_code;
          
        }
        else {
          text =''// nieuwPopup;
        }
        var popup = new OpenLayers.Popup("", 
         feature.geometry.getBounds().getCenterLonLat(),
         null, 
         text,
         true);
        
        popup.autoSize = true;

        feature.popup = popup;
         map.addPopup(popup);
         }
         else {
          feature.popup.show();
         }
    }

    map.addControls([perceelcontrol,navcontrol,editcontrol,selectcontrol]);
    

    map.setCenter(new OpenLayers.LonLat(199000,434000),8)

    $('#btn-nav').change(function(){
      perceelcontrol.deactivate();
      editcontrol.deactivate();
      navcontrol.activate();
      $('#btn-class').removeClass('active');
    })
    $('#btn-perceel').change(function(){
      perceelcontrol.activate();
      editcontrol.deactivate();
      navcontrol.deactivate();
      $('#btn-class').removeClass('active');
    })   
    $('#btn-edit').change(function(){
      perceelcontrol.deactivate();
      editcontrol.activate();
      navcontrol.deactivate();
      $('#btn-class').removeClass('active');
    }) 
    $('#btn-class').click(function(){
      perceelcontrol.deactivate();
      editcontrol.deactivate();
      navcontrol.activate();
      selectcontrol.activate();
       $('.btn').removeClass('active');
       $(this).addClass('active');

    })
}



    </script>
  </head>
<body onload="init()">
 <div class="container-fluid">
 
    <div class="col-xs-8 col-md-8 hoog"><div id="map"></div></div>
    <div class="col-xs-4 col-md-4 hoog">
      
      <div class="uitleg selecteren">
       <p> Gebruik onderstaande knoppen om 1 of meer gebieden te selecteren om te herclassificeren.</p>
      <p class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary active"  data-toggle="tooltip" data-placement="top" title="Navigeren op de kaart">
          <input type="radio" name="options" data-toggle="button" id="btn-nav"><span class="glyphicon glyphicon-hand-up"></span>
        </label>
        <label class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Selecteer 1 of meer (shift-toets) percelen om te herclassificeren">
          <input type="radio" name="options" id="btn-perceel">Bestaande percelen
        </label>
        <label class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Teken 1 of meer gebieden om te herclassificeren">
          <input type="radio" name="options" id="btn-edit"><span class="glyphicon glyphicon-pencil"></span>
        </label>
      
    </p>
  </div>
      <div class="uitleg classificeren text-muted">
        <p>Klik op 'Classificeren' om te beginnen met herclassificeren. Klik vervolgens op de blauwe gebieden  om een nieuwe classificatie toe te kennen</p>
        <p>Als alle gebieden de juiste classificate hebben, klik op 'Bereken' om de berekening te starten</p>
     <button type="button" id="btn-class" class="btn btn-primary" disabled="disabled">Classificeren</button>
     <button type="button" id="btn-calc" class="btn btn-success" disabled="disabled">Bereken</button>
      </div>
    </div>   
  </div>
</body>
</html>